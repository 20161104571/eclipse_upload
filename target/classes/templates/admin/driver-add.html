<!DOCTYPE html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org">
  
  <head>
    <meta charset="UTF-8">
    <title>添加司机信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="static/css/font.css">
    <link rel="stylesheet" href="static/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="static/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="static/js/xadmin.js"></script>
    <script type="text/javascript" src="static/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
    <div class="x-body">
        <form class="layui-form" action="saveDriver" method="post">
        <input type="hidden" name="dId"  id="dId" th:value="${dId}">
          <div class="layui-form-item">
              <label for="dname" class="layui-form-label">
                  <span class="x-red">*</span>司机姓名
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="dname" name="dname" required="" lay-verify="dname"
                  autocomplete="off" class="layui-input" th:value="${dname}">
              </div>
              
          </div>
          <div class="layui-form-item">
              <label for="dnumber" class="layui-form-label">
                  <span class="x-red">*</span>工号
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="dnumber" name="dnumber" required="" lay-verify="dnumber"
                  autocomplete="off" class="layui-input" th:value="${dnumber}">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="dphone" class="layui-form-label">
                  <span class="x-red">*</span>电话号码
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="dphone" name="dphone" required="" lay-verify="dphone"
                  autocomplete="off" class="layui-input" th:value="${dphone}">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
                  <span class="x-red">*</span>驾龄
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="driverTime" name="driverTime" required="" lay-verify="driverTime"
                  autocomplete="off" class="layui-input" th:value="${driverTime}">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
              </label>
              <button  class="layui-btn" lay-filter="add" lay-submit="add" id="save">
                  增加
              </button>
          </div>
      </form>
    </div>
    <script>
        layui.use(['form','layer'], function(){
            $ = layui.jquery;
          var form = layui.form
          ,layer = layui.layer;
        
          //监听提交
          /* form.on('submit(add)', function(data){
            console.log(data);
            //发异步，把数据提交给php
            
            layer.alert("增加成功", {icon: 4},function () {
                //关闭当前frame
                x_admin_close();

                // 可以对父窗口进行刷新 
                x_admin_father_reload();
            });
            return false;
          });  */
          /* form.on('submit(add)', function(data){
        	  console.log(data);
        	  var serialStr = $("#driver-add").serialize();
              //发异步，把数据提交给php
              $.ajax({
            	  type:'post',
               	  url:'saveDriver',
               	  data:serialStr,
               	  dataType:'text',
               	  success:function(data){
               		  if(data=="1"){
               			layer.alert("增加成功", {icon: 4},function (){
                       		//关闭当前frame
            	                x_admin_close();
            	                // 可以对父窗口进行刷新 
            	                x_admin_father_reload();
               			});
               		  }else{
                 			//window.location.href="http://localhost:8080/shop/admin/error.jsp";
               			}
               	  },
               	  error:function(){
               		window.console.log('失败回调函数')
               	  }
              });
          });  */
	
          $(function(){
        	    //var serialStr = $("#driveradd").serialize();//序列化表单
        	    var dId = $("#dId").val();
        	    $.ajax({  
        	        type:'post',
        	        url:'saveDriver',
        	        data:{"dId":dId},
        	        dataType:'json',
        	        success:function(code){  
        	            	$("#dname").val(code.dname);
        	            	$("#dnumber").val(code.dnumber);
        	            	$("#dphone").val(code.dphone);
        	            	$("#driverTime").val(code.driverTime);
        	            	if(code=="1"){
                       			layer.alert("增加成功", {icon: 4},function (){
                               		//关闭当前frame
                    	                x_admin_close();
                    	                // 可以对父窗口进行刷新 
                    	                x_admin_father_reload();
                       			});
        	            	//if  (code ==0) {
        	                //layer.msg('添加成功!',{icon:1,time:1000});
        	            //}//else{  
        	                //layer.msg('添加失败!',{icon:2,time:1000});
        	            //}
        	            //parent.$('.btn-refresh').click();
        	        },error:function(){
        	        	//layer.msg('添加失败!',{icon:2,time:1000});
                    }
        	    });
        	    //var index=parent.layer.getFrameIndex(window.name);//获取当前弹出层的层级
//        	    parent.$('.btn-refresh').click();//刷新父页面
        	    //parent.layer.close(index);//关闭弹出层
        	    //window.parent.location.reload();//刷新父页面
        	})
        	form.on('submit(add)', function(code) {
                //var index = layer.msg('提交中，请稍候',{icon: 16,time:false,shade:0.8});
                var d = code.field;
                var url = "saveDriver";
                
                $.ajax({
                    url: url,
                    data:d,
                    dataType:"text",
                    success: function(code){
                        layer.close(index);
                        if(code == 0){
                            layer.msg("保存成功！");
                            /* parent.queryTea();
                            parent.close(); */
                            var index=parent.layer.getFrameIndex(window.name);//获取当前弹出层的层级
//                    	    parent.$('.btn-refresh').click();//刷新父页面
                    	    parent.layer.close(index);//关闭弹出层
                    	    window.parent.location.reload();//刷新父页面
                        }else{
                            layer.msg("保存失败！");
                        }
                    },error:function(){
                        layer.close(index);
                        layer.msg("保存失败！");
                    }
                });
                return false;
            });
        });

          /* $(function(){
              var dId = $("#dId").val();
              var serialStr = $("#driver-add").serialize();//序列化表单
              if(dId != ""){
                  $.ajax({
                      url: "saveDriver",
                      data:serialStr,{"dId":dId},
                      dataType:"json",
                      success: function(data){
                    	  $("#dname").val(code.dname);
      	            	$("#dnumber").val(code.dnumber);
      	            	$("#dphone").val(code.dphone);
      	            	$("#driverTime").val(code.driverTime);
      	            	
                      },error:function(){
                      }
                  });
                  
              }
          }) */

          
          });
          </script>
          
          <script>var _hmt = _hmt || []; (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();</script>
    
  </body>

</html>